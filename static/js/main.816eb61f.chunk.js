(this.webpackJsonpwebbackpack=this.webpackJsonpwebbackpack||[]).push([[0],{60:function(e,t,n){e.exports=n(76)},65:function(e,t,n){},72:function(e,t,n){},76:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(8),s=n.n(c),o=(n(65),n(37)),u=n(5),i=n.n(u),l=n(36),d=n(16),f=a.a.createContext({}),v={headerBackground:"#0C1B33",headerTitle:"#F4E87C",videoControlIcons:"#46d6e3"},p=30,h={color:v.headerTitle,fontSize:p},m=(v.videoControlIcons,n(47)),y=n.n(m),b=n(49),w=n.n(b),q=n(50),g=n.n(q);function x(e){var t=Object(r.useContext)(f),n=a.a.createElement("div",{style:{width:p}});"RequestsList"===t.currentScreen&&(n=a.a.createElement("div",{onClick:function(){return t.setCurrentScreen("AddRequest")}},a.a.createElement(y.a,{style:h})));var c=a.a.createElement("div",{style:{width:p}});return"RequestContent"===t.currentScreen?c=a.a.createElement("div",{onClick:function(){return t.setCurrentScreen("RequestsList")}},a.a.createElement(w.a,{style:h})):"SelectSource"!==t.currentScreen&&(c=a.a.createElement("div",{onClick:function(){return t.setCurrentScreen("SelectSource")}},a.a.createElement(g.a,{style:h}))),a.a.createElement("div",{style:E.screen},a.a.createElement("div",{style:E.header},c,a.a.createElement("div",{style:E.title},e.title),n),a.a.createElement("div",{style:E.content},e.children))}var E={screen:{height:"100%",display:"flex",flexDirection:"column"},header:{height:60,backgroundColor:v.headerBackground,justifyContent:"space-between",padding:"0 3vw",display:"flex",alignItems:"center",flexDirection:"row"},title:{color:v.headerTitle,fontSize:20},content:{flexGrow:1}},C="http://192.168.43.73:5000/";function R(e){var t,n,r;return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t=C+"add_request",a.next=3,i.a.awrap(fetch(t,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}));case 3:if(n=a.sent,r=null,!n.ok){a.next=9;break}return a.next=8,i.a.awrap(n.json());case 8:r=a.sent;case 9:return a.abrupt("return",r);case 10:case"end":return a.stop()}}))}function k(e){var t,n,r;return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t=C+"send_results",a.next=3,i.a.awrap(fetch(t,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}));case 3:return n=a.sent,a.next=6,i.a.awrap(n.json());case 6:return r=a.sent,a.abrupt("return",r);case 8:case"end":return a.stop()}}))}function S(e){var t,n;return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return t=C+e.links[0],r.next=3,i.a.awrap(fetch(t).then((function(e){return e.blob()})));case 3:return n=r.sent,r.abrupt("return",n);case 5:case"end":return r.stop()}}))}n(71),n(72);var j=n(51),O=null;function W(){var e;return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return(O=new j.a("requests")).version(1).stores({requests:"id, query, status, type, mode, server_request_id",content:"id"}),console.log("Database Initialized"),t.next=5,i.a.awrap(O.requests.toArray());case 5:return e=t.sent,t.abrupt("return",e);case 7:case"end":return t.stop()}}))}function I(e,t){var n;return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("Adding content for requestId",e,t),r.next=3,i.a.awrap(O.content.put({id:e,content:t}));case 3:n=r.sent,console.log("response",n);case 5:case"end":return r.stop()}}))}function _(e){var t;return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.a.awrap(O.content.where("id").equals(e).toArray());case 2:return t=n.sent,n.abrupt("return",t[0].content);case 4:case"end":return n.stop()}}))}function A(e){var t={screen:{backgroundColor:"Youtube"===e.title?"black":"white",borderRadius:10,marginTop:"10px",padding:"5px",display:"flex",alignItems:"center",justifyContent:"center",height:"100px",width:"100vw"},text:{fontSize:30,color:v.headerBackground,fontWeight:"bold"}};return a.a.createElement("div",{onClick:e.onClick},a.a.createElement("div",{style:t.screen},a.a.createElement("div",{style:t.text},e.title)))}function L(){var e=this,t=Object(r.useContext)(f);function n(e){t.setCurrentScreen("RequestsList"),t.setSource(e)}var c=t.sources.map((function(t){return a.a.createElement(A,{title:t,onClick:n.bind(e,t),key:t})}));return a.a.createElement("div",{style:{}},c)}function P(e){var t=Object(r.useContext)(f),n=Object(r.useRef)();Object(r.useEffect)((function(){n.current&&function(){var e;i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.a.awrap(_(t.currentRequest.id));case 2:e=r.sent,console.log("videoBlob",e),n.current.src=window.URL.createObjectURL(e);case 5:case"end":return r.stop()}}))}()}),[t.currentRequest.id]);var c={screen:{backgroundColor:"Youtube"===t.currentRequest.type?"black":"white",display:"flex",justifyContent:"center",height:"100%"},title:{fontSize:16}},s=null;if("Youtube"===t.currentRequest.type&&(s=a.a.createElement("video",{width:"100%",controls:!0,ref:n})),"Wikitravel"===t.currentRequest.type){var o=t.currentRequest.links.filter((function(e){return e.indexOf("index.html")>=0}))[0];s=a.a.createElement("a",{href:C+o}," Go to resource ")}return a.a.createElement("div",{style:c.screen},s)}var B=n(52),D=n.n(B);function T(e){var t=Object(r.useContext)(f);return a.a.createElement("div",{style:z.screen},a.a.createElement("div",{style:z.firstColumn,onClick:function(){e.downloaded&&(t.setCurrentScreen("RequestContent"),t.setCurrentRequest(e.request))}},a.a.createElement("div",{style:z.infos},e.request.id," / ",e.request.mode," / ",e.request.status),a.a.createElement("div",{style:z.query},e.request.query)),a.a.createElement("div",{onClick:function(){t.dispatchAllRequests({type:"remove",reqId:e.request.id}),function(e){var t;i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.a.awrap(O.requests.delete(e));case 2:return t=n.sent,n.abrupt("return",t);case 4:case"end":return n.stop()}}))}(e.request.id),"downloadedLocally"===e.request.status&&function(e){var t;i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.a.awrap(O.content.delete(e));case 2:return t=n.sent,n.abrupt("return",t);case 4:case"end":return n.stop()}}))}(e.request.id)}},a.a.createElement(D.a,{size:30,style:{color:"pink"}})))}var z={screen:{padding:"1%",margin:"2%",maxWidth:"90%",display:"flex",flexDirection:"row",alignItems:"center"},firstColumn:{flexGrow:1,marginRight:"5%",maxWidth:"90%",borderBottomColor:"grey",borderBottomWidth:1},infos:{color:"grey",fontSize:12},query:{fontWeight:"bold",marginHorizontal:"2vw",fontSize:16,marginVertical:"1%",maxWidth:"100vw"}};function N(e){var t=Object(r.useContext)(f);function n(e){return"Youtube"===e.type?"downloadedLocally"===e.status:"downloadedServer"===e.status}var c=t.allRequests.filter((function(e){return e.type===t.source})).map((function(e){return a.a.createElement(T,{request:e,key:e.id,downloaded:n(e)})}));return a.a.createElement("div",null,c)}var Y=n(113),U=n(117),J=n(114),G=n(118),H=n(112),M=n(115),V=n(116),F=n(109);function K(e){var t=Object(r.useState)(""),n=Object(d.a)(t,2),c=n[0],s=n[1],o=Object(r.useState)(!1),u=Object(d.a)(o,2),l=u[0],v=u[1],p=Object(r.useState)(0),h=Object(d.a)(p,2),m=h[0],y=h[1],b=Object(r.useContext)(f);var w=null;"Youtube"===b.source&&(w=a.a.createElement("div",{style:$.video},a.a.createElement(M.a,{labelPlacement:"start",label:l?"Video & Audio":"Only Audio",control:a.a.createElement(J.a,{checked:l,onChange:function(){return v((function(e){return!e}))},value:"video",color:"primary",inputProps:{"aria-label":"primary checkbox"}})})));var q=null;return"Wikitravel"===b.source&&(q=a.a.createElement(F.a,null,a.a.createElement(V.a,{id:"demo-simple-select-label"},"Level"),a.a.createElement(Y.a,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:m,onChange:function(e){return y(e.target.value)}},a.a.createElement(U.a,{value:"0"},"0"),a.a.createElement(U.a,{value:"1"},"1")))),a.a.createElement("div",{style:$.screen},a.a.createElement(G.a,{id:"standard-basic",label:"What are you looking for?",value:c,onChange:function(e){return s(e.target.value)}}),w,q,a.a.createElement("div",{style:$.buttons},a.a.createElement(H.a,{color:"secondary",onClick:function(){return b.setCurrentScreen("RequestsList")}},"Cancel"),a.a.createElement(H.a,{color:"primary",onClick:function(){var e,t,n;return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:e=l?"video":"audio","Wikitravel"===b.source&&(e=m),t=b.getNextRequestId(),console.log("NextRequestId",t),n={user_id:b.userId,id:b.getNextRequestId(),query:c,status:"saved",type:b.source,mode:e},b.dispatchAllRequests({type:"add",newReq:n}),b.setCurrentScreen("RequestsList");case 7:case"end":return r.stop()}}))}},"Add Request")))}var $={screen:{display:"flex",flexDirection:"column",alignItems:"center",height:200,minHeight:"50%",padding:"10%",justifyContent:"space-around"},video:{display:"flex",flexDirection:"row",justifyContent:"flex-end",marginRight:"3%"},textInput:{borderBottomWidth:1,borderBottomColor:"grey"},buttons:{display:"flex",flexDirection:"row",justifyContent:"space-around"},levelSelect:{display:"flex",flexDirection:"row",justifyContent:"space-around"},levelPicker:{width:"29%",height:20}};function Q(e,t){switch(t.type){case"add":return[].concat(Object(l.a)(e),[t.newReq]);case"remove":return e.filter((function(e){return e.id!==t.reqId}));case"init-requests":return Object(l.a)(t.requests);case"updateReceivedServer":var n=Object(o.a)({},e.filter((function(e){return e.id===t.serverRequest.id}))[0]);return n.server_request_id=t.serverRequest.server_request_id,n.status="receivedServer",e.map((function(e){return e.id===n.id?n:e}));case"updateDownloaded":var r=Object(o.a)({},e.filter((function(e){return e.server_request_id===t.serverResponse.server_request_id}))[0]);return r.status="downloadedServer",r.links=t.serverResponse.links,e.map((function(e){return e.server_request_id===t.serverResponse.server_request_id?r:e}));case"updateDownloadedLocally":var a=Object(o.a)({},t.request);return a.status="downloadedLocally",e.map((function(e){return e.id===a.id?a:e}));default:throw Error("error in reducerReqs, App.js")}}var X=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Z(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}s.a.render(a.a.createElement((function(){var e=Object(r.useReducer)(Q,[]),t=Object(d.a)(e,2),n=t[0],c=t[1],s=Object(r.useState)(null),o=Object(d.a)(s,2),u=o[0],v=o[1],p=Object(r.useState)("SelectSource"),h=Object(d.a)(p,2),m=h[0],y=h[1],b=Object(r.useState)({}),w=Object(d.a)(b,2),q=w[0],g=w[1],E={SelectSource:{screen:L,title:"WebBackPack"},RequestsList:{screen:N,title:u},RequestContent:{screen:P,title:q.query},AddRequest:{screen:K,title:"Add "+u}},C={userId:"Parvati",sources:["Youtube","Wikitravel"],getNextRequestId:function(){return n.length>0?Math.max.apply(Math,Object(l.a)(n.map((function(e){return e.id}))))+1:1},allRequests:n,dispatchAllRequests:c,currentScreen:m,setCurrentScreen:y,source:u,setSource:v,setCurrentRequest:g,currentRequest:q};Object(r.useEffect)((function(){!function(){var e;i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.a.awrap(W());case 2:e=t.sent,c({type:"init-requests",requests:e});case 4:case"end":return t.stop()}}))}()}),[]),Object(r.useEffect)((function(){n.length>0&&function(e){var t;i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("putting all requests to db",e),n.next=3,i.a.awrap(O.requests.bulkPut(e));case 3:t=n.sent,console.log("response",t);case 5:case"end":return n.stop()}}))}(n)}),[n]),Object(r.useEffect)((function(){!function(){var e,t;i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return e=C.allRequests.filter((function(e){return"saved"===e.status})),t=e.map((function(e){return R(e)})),n.next=4,i.a.awrap(Promise.all(t));case 4:n.sent.filter((function(e){return"server_request_id"in e})).forEach((function(e){c({type:"updateReceivedServer",serverRequest:e})}));case 6:case"end":return n.stop()}}))}()})),Object(r.useEffect)((function(){!function(){var e,t;i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return e=C.allRequests.filter((function(e){return"receivedServer"===e.status})),t=e.map((function(e){return k(e)})),n.next=4,i.a.awrap(Promise.all(t));case 4:n.sent.filter((function(e){return"OK"===e.status})).forEach((function(e){c({type:"updateDownloaded",serverResponse:e})}));case 6:case"end":return n.stop()}}))}()})),Object(r.useEffect)((function(){!function(){var e,t,r;i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return e=n.filter((function(e){return"Youtube"===e.type&&"downloadedServer"===e.status})),t=e.map((function(e){return S(e)})),a.next=4,i.a.awrap(Promise.all(t));case 4:r=a.sent,e.forEach((function(e,t){return I(e.id,r[t])})),e.forEach((function(e){return c({type:"updateDownloadedLocally",request:e})}));case 7:case"end":return a.stop()}}))}()}),[n]);var j=E[m].screen;return a.a.createElement(f.Provider,{value:C},a.a.createElement(x,{title:E[m].title},a.a.createElement(j,null)))}),null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");X?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Z(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):Z(t,e)}))}}()}},[[60,1,2]]]);
//# sourceMappingURL=main.816eb61f.chunk.js.map